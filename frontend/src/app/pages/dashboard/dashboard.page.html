<!-- frontend/src/app/pages/dashboard/dashboard.page.html -->
<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <mat-icon color="warn">error_outline</mat-icon>
    <h3>Error al cargar el dashboard</h3>
    <p>{{ error }}</p>
    <button
      mat-raised-button
      color="primary"
      (click)="vistaTrabajadorActiva ? loadDashboardDataTrabajador() : loadDashboardData()"
    >
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">
    <!-- ==================== -->
    <!-- DASHBOARD ADMINISTRADOR -->
    <!-- ==================== -->
    <div *ngIf="vistaActualEsAdministrador" class="admin-dashboard">
      <!-- Header Admin -->
      <header class="dashboard-header">
        <div class="welcome-section">
          <h1>Bienvenido, {{ usuario?.nombre }} {{ usuario?.apellidos }}</h1>
          <div class="role-info">
            <p class="role-badge administrador">{{ statsParaMostrar.rol | titlecase }}</p>
            <span class="vista-indicator">Vista Administrador</span>
          </div>
        </div>
        <div class="header-actions">
          <button
            mat-raised-button
            color="accent"
            (click)="cambiarVistaTrabajador()"
            class="view-switch-btn"
          >
            <mat-icon>switch_account</mat-icon>
            {{ vistaTrabajadorActiva ? 'Volver a Admin' : 'Vista Trabajador' }}
          </button>
          <button mat-raised-button color="primary" routerLink="/calendario">
            <mat-icon>calendar_today</mat-icon>
            Calendario General
          </button>
          <button mat-raised-button color="warn" (click)="logout()" class="logout-btn">
            <mat-icon>logout</mat-icon>
            Cerrar Sesión
          </button>
        </div>
      </header>

      <!-- Estadísticas del Negocio -->
      <section class="section">
        <h2>📈 Estadísticas del Negocio</h2>
        <div class="stats-grid">
          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>event</mat-icon>
              <mat-card-title>Reservas Hoy</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.totalReservasHoy }}</div>
              <div class="stat-label">Total citas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>check_circle</mat-icon>
              <mat-card-title>Confirmadas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasConfirmadas }}</div>
              <div class="stat-label">Confirmadas hoy</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>schedule</mat-icon>
              <mat-card-title>Pendientes</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasPendientes }}</div>
              <div class="stat-label">Por confirmar</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>euro</mat-icon>
              <mat-card-title>Ingresos por Ventas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ formatCurrency(statsParaMostrar.ingresosHoy) }}</div>
              <div class="stat-label">Ventas completadas hoy</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>shopping_cart</mat-icon>
              <mat-card-title>Ventas Hoy</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.totalVentasHoy }}</div>
              <div class="stat-label">Productos vendidos</div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Servicios Populares -->
      <section class="section" *ngIf="statsParaMostrar.serviciosPopulares.length > 0">
        <h2>💎 Servicios Más Populares</h2>
        <div class="servicios-grid">
          <mat-card
            *ngFor="let servicio of statsParaMostrar.serviciosPopulares"
            class="servicio-card"
          >
            <mat-card-header>
              <mat-icon mat-card-avatar>spa</mat-icon>
              <mat-card-title>{{ servicio.nombre }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="popularity-badge">
                <mat-icon>trending_up</mat-icon>
                {{ servicio.total_reservas }} reservas
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Acciones Rápidas Admin -->
      <section class="section">
        <h2>🚀 Acciones Rápidas</h2>
        <div class="quick-actions">
          <button mat-raised-button color="primary" routerLink="/calendario" class="action-btn">
            <mat-icon>calendar_today</mat-icon>
            Calendario General
          </button>
          <button mat-raised-button color="accent" routerLink="/admin/ausencias" class="action-btn">
            <mat-icon>event_busy</mat-icon>
            Gestionar Ausencias
          </button>
          <button mat-raised-button color="primary" class="action-btn" disabled>
            <mat-icon>analytics</mat-icon>
            Reportes (Próximamente)
          </button>
          <button mat-raised-button color="accent" class="action-btn" disabled>
            <mat-icon>settings</mat-icon>
            Configuración (Próximamente)
          </button>
        </div>
      </section>
    </div>

    <!-- ==================== -->
    <!-- DASHBOARD TRABAJADOR -->
    <!-- ==================== -->
    <div *ngIf="vistaActualEsTrabajador" class="trabajador-dashboard">
      <!-- Header Trabajador -->
      <header class="dashboard-header">
        <div class="welcome-section">
          <h1>Bienvenido, {{ usuario?.nombre }} {{ usuario?.apellidos }}</h1>
          <div class="role-info">
            <p class="role-badge trabajador">{{ statsParaMostrar.rol | titlecase }}</p>
            <span class="vista-indicator" *ngIf="vistaTrabajadorActiva"
              >Vista Trabajador (Admin)</span
            >
          </div>
        </div>
        <div class="header-actions">
          <button
            *ngIf="isAdministrador"
            mat-raised-button
            color="accent"
            (click)="cambiarVistaTrabajador()"
            class="view-switch-btn"
          >
            <mat-icon>switch_account</mat-icon>
            Volver a Admin
          </button>
          <button mat-raised-button color="primary" routerLink="/mi-calendario">
            <mat-icon>calendar_today</mat-icon>
            Mi Calendario
          </button>
          <button mat-raised-button color="warn" (click)="logout()" class="logout-btn">
            <mat-icon>logout</mat-icon>
            Cerrar Sesión
          </button>
        </div>
      </header>

      <!-- Mi Actividad Hoy -->
      <section class="section">
        <h2>📈 Mi Actividad Hoy</h2>
        <div class="stats-grid">
          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>event</mat-icon>
              <mat-card-title>Citas Hoy</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.totalReservasHoy }}</div>
              <div class="stat-label">Total citas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>check_circle</mat-icon>
              <mat-card-title>Confirmadas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasConfirmadas }}</div>
              <div class="stat-label">Confirmadas hoy</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>schedule</mat-icon>
              <mat-card-title>Pendientes</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasPendientes }}</div>
              <div class="stat-label">Por confirmar</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>shopping_cart</mat-icon>
              <mat-card-title>Mis Ventas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.totalVentasHoy }}</div>
              <div class="stat-label">Ventas realizadas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>euro</mat-icon>
              <mat-card-title>Mis Ingresos</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ formatCurrency(statsParaMostrar.ingresosHoy) }}</div>
              <div class="stat-label">Por ventas hoy</div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Servicios Populares -->
      <section class="section" *ngIf="statsParaMostrar.serviciosPopulares.length > 0">
        <h2>💎 Servicios Más Solicitados</h2>
        <div class="servicios-grid">
          <mat-card
            *ngFor="let servicio of statsParaMostrar.serviciosPopulares"
            class="servicio-card"
          >
            <mat-card-header>
              <mat-icon mat-card-avatar>spa</mat-icon>
              <mat-card-title>{{ servicio.nombre }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="popularity-badge">
                <mat-icon>trending_up</mat-icon>
                {{ servicio.total_reservas }} reservas
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Próximas Reservas -->
      <section class="section" *ngIf="statsParaMostrar.proximasReservas.length > 0">
        <h2>📅 Mis Próximas Reservas</h2>
        <div class="reservas-list">
          <mat-card *ngFor="let reserva of statsParaMostrar.proximasReservas" class="reserva-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>event</mat-icon>
              <mat-card-title>{{ reserva.servicio_nombre }}</mat-card-title>
              <mat-card-subtitle>
                {{ formatDate(reserva.fecha_reserva) }} a las {{ formatTime(reserva.hora_inicio) }}
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>
                <strong>{{ formatCurrency(reserva.servicio_precio) }}</strong>
              </p>
              <p class="estado-reserva">{{ reserva.estado | titlecase }}</p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button color="primary" routerLink="/mi-calendario">
                <mat-icon>visibility</mat-icon>
                Ver Detalles
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </section>

      <!-- Acciones Rápidas Trabajador -->
      <section class="section">
        <h2>🚀 Acciones Rápidas</h2>
        <div class="quick-actions">
          <button mat-raised-button color="primary" routerLink="/mi-calendario" class="action-btn">
            <mat-icon>calendar_today</mat-icon>
            Mi Calendario
          </button>
          <button mat-raised-button color="accent" class="action-btn" disabled>
            <mat-icon>groups</mat-icon>
            Mis Clientes (Próximamente)
          </button>
          <button mat-raised-button color="primary" class="action-btn" disabled>
            <mat-icon>spa</mat-icon>
            Gestión Servicios (Próximamente)
          </button>
        </div>
      </section>
    </div>

    <!-- ================= -->
    <!-- DASHBOARD CLIENTE -->
    <!-- ================= -->
    <div *ngIf="isCliente" class="cliente-dashboard">
      <!-- Header Cliente -->
      <header class="dashboard-header">
        <div class="welcome-section">
          <h1>Bienvenido, {{ usuario?.nombre }} {{ usuario?.apellidos }}</h1>
          <p class="role-badge cliente">{{ statsParaMostrar.rol | titlecase }}</p>
        </div>
        <div class="header-actions">
          <button mat-raised-button color="primary" routerLink="/servicios" class="action-btn">
            <mat-icon>event_available</mat-icon>
            Nueva Reserva
          </button>
          <button mat-raised-button color="warn" (click)="logout()" class="logout-btn">
            <mat-icon>logout</mat-icon>
            Cerrar Sesión
          </button>
        </div>
      </header>

      <!-- Mis Estadísticas -->
      <section class="section">
        <h2>📈 Mis Estadísticas</h2>
        <div class="stats-grid">
          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>today</mat-icon>
              <mat-card-title>Reservas Hoy</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.misReservasHoy }}</div>
              <div class="stat-label">Citas para hoy</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>event_note</mat-icon>
              <mat-card-title>Total Reservas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.totalReservas }}</div>
              <div class="stat-label">Reservas totales</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>check_circle</mat-icon>
              <mat-card-title>Confirmadas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasConfirmadas }}</div>
              <div class="stat-label">Reservas confirmadas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>schedule</mat-icon>
              <mat-card-title>Pendientes</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ statsParaMostrar.reservasPendientes }}</div>
              <div class="stat-label">Por confirmar</div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Próximas Reservas -->
      <section class="section" *ngIf="statsParaMostrar.proximasReservas.length > 0">
        <h2>📅 Mis Próximas Reservas</h2>
        <div class="reservas-list">
          <mat-card *ngFor="let reserva of statsParaMostrar.proximasReservas" class="reserva-card">
            <mat-card-header>
              <mat-icon mat-card-avatar>event</mat-icon>
              <mat-card-title>{{ reserva.servicio_nombre }}</mat-card-title>
              <mat-card-subtitle>
                {{ formatDate(reserva.fecha_reserva) }} a las {{ formatTime(reserva.hora_inicio) }}
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>
                <strong>{{ formatCurrency(reserva.servicio_precio) }}</strong>
              </p>
              <p class="estado-reserva">{{ reserva.estado | titlecase }}</p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button color="primary" routerLink="/mis-reservas">
                <mat-icon>visibility</mat-icon>
                Ver Detalles
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </section>

      <!-- Acciones Rápidas Cliente -->
      <section class="section">
        <h2>🚀 Acciones Rápidas</h2>
        <div class="quick-actions">
          <!-- Este va directamente a reservar -->
          <button mat-raised-button color="primary" (click)="irAReservar()" class="action-btn">
            <mat-icon>event_available</mat-icon>
            Reservar Cita
          </button>
          <!-- Este va al catálogo de servicios -->
          <button mat-raised-button color="accent" routerLink="/servicios" class="action-btn">
            <mat-icon>spa</mat-icon>
            Ver Servicios
          </button>
          <button mat-raised-button color="primary" routerLink="/mis-reservas" class="action-btn">
            <mat-icon>list_alt</mat-icon>
            Mis Reservas
          </button>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
      <p>&copy; 2025 Peluquería y Estética Selene. Todos los derechos reservados.</p>
    </footer>
  </div>
</div>
